<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zira Artifacts - My Account</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/logo.png') }}">
    <!-- Toastify CSS & JS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
<script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

    <!-- Custom Styles -->
    <style>
        .toastify {
    z-index: 3000 !important;
    font-family: 'Poppins', sans-serif;
}
        /* Custom Font */
        body, .navbar {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding-top: 80px; /* Prevent navbar overlap */
        }

        /* Animations */
        .animate-fadeIn { animation: fadeIn 0.8s ease-out forwards; }
        .animate-slideIn { animation: slideIn 0.6s ease-out forwards; }
        .animate-bounceIn { animation: bounceIn 1s ease-out forwards; }
        .animate-zoomIn { animation: zoomIn 5s ease-out forwards; }
        .animate-pageLoad { animation: pageLoad 1s ease-out forwards; }
        .animate-navLoad { animation: navLoad 0.8s ease-out forwards; }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes bounceIn {
            0% { opacity: 0; transform: scale(0.95); }
            50% { opacity: 0.5; transform: scale(1.05); }
            100% { opacity: 1; transform: scale(1); }
        }
        @keyframes zoomIn {
            from { background-size: 100%; }
            to { background-size: 110%; }
        }
        @keyframes pageLoad {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes navLoad {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Toggler Animations */
        .animate-rotateToggle { animation: rotateToggle 0.3s ease-in-out forwards; }
        .animate-bounce { animation: bounce 0.2s ease-in-out; }
        .animate-pulse { animation: pulse 0.3s ease-in-out; }
        @keyframes rotateToggle {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(90deg) scale(1.2); }
            100% { transform: rotate(180deg) scale(1); }
        }
        @keyframes bounce {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Delay Classes */
        .delay-\[100ms\] { animation-delay: 100ms; }
        .delay-\[200ms\] { animation-delay: 200ms; }
        .delay-\[300ms\] { animation-delay: 300ms; }

        /* Navbar Styling */
        .navbar {
            background: #ffffff;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 1rem 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000; /* Increased to ensure navbar is above content */
            animation: navLoad 0.8s ease-out;
        }
        .navbar .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        @media (min-width: 640px) {
            .navbar .container {
                padding: 0 2rem;
            }
        }
        .navbar-item {
            position: relative;
            font-size: 1.1rem;
            font-weight: 500;
            color: #4b5563;
            padding: 0.5rem 1rem;
            transition: all 0.3s ease;
            border-radius: 8px;
        }
        .navbar-item:hover, .navbar-item.active {
            color: #1f2937;
            transform: scale(1.05);
            background-color: rgba(0, 0, 0, 0.05);
        }
        .navbar-item::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 2px;
            background-color: #1f2937;
            transition: width 0.3s ease;
        }
        .navbar-item:hover::after, .navbar-item.active::after {
            width: 50%;
        }
        .nav-hover:hover {
            transform: scale(1.05);
        }

        /* Search Container */
        .search-container {
            position: relative;
        }
        .search-container input {
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            padding: 0.5rem 2.5rem 0.5rem 0.75rem;
            outline: none;
            transition: border-color 0.3s ease;
        }
        .search-container input:focus {
            border-color: #d97706;
            box-shadow: 0 0 0 3px rgba(217, 119, 6, 0.2);
        }
        .search-container .fa-search {
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: #6b7280;
        }
        #mobile-search-bar {
            display: none;
            position: absolute;
            top: 3rem;
            left: 0;
            right: 0;
            margin: 0 0.5rem;
            z-index: 1001; /* Above navbar */
            background: #ffffff;
            border-radius: 0.375rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        #mobile-search-bar.active {
            display: block;
        }

        /* Currency Button Container */
        #country-btn-container, #mobile-country-btn-container {
            position: relative;
            display: flex;
            align-items: center;
            flex-shrink: 0;
            padding-top: 1.5rem; /* Space for floating text */
            z-index: 1002; /* Ensure container is above other content */
        }
        #country-btn, #mobile-country-btn {
            position: relative;
            background-color: #d97706 !important;
        }
        .floating-text {
            position: absolute;
            top: -1.5rem; /* Position above button */
            left: 50%;
            transform: translateX(-50%);
            background-color: #ffffff;
            color: #4b5563;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 500;
            white-space: nowrap;
            z-index: 1003; /* Above button */
            text-align: center;
        }
        #country-btn-container button, #mobile-country-btn-container button {
            background-color: #ffffff;
            color: #4b5563;
            padding: 0.5rem 0.75rem;
            border-radius: 9999px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s ease, transform 0.3s ease;
            display: flex;
            align-items: center;
            font-size: 0.875rem;
            min-width: 60px;
        }
        #country-btn-container button:hover, #mobile-country-btn-container button:hover {
            background-color: #f3f4f6;
            transform: scale(1.05);
        }
        #country-btn-container #country-dropdown, #mobile-country-btn-container #mobile-country-dropdown {
            top: calc(100% + 0.5rem); /* Add space below button */
            right: 0;
            z-index: 1004; /* Above all content */
            width: 120px;
            padding: 0.5rem;
            background-color: #ffffff;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-radius: 0.375rem;
            position: absolute;
        }
        #country-btn-container #country-dropdown a, #mobile-country-btn-container #mobile-country-dropdown a {
            font-size: 0.875rem;
            color: #4b5563;
            transition: color 0.3s ease;
            display: block;
            padding: 0.25rem 0.5rem;
        }
        #country-btn-container #country-dropdown a:hover, #mobile-country-btn-container #mobile-country-dropdown a:hover {
            color: #1f2937;
            background-color: #f3f4f6;
        }

        /* Mobile Navbar Flex Container */
        .navbar .md:hidden .flex.items-center.space-x-1 {
            overflow: visible;
            flex-wrap: nowrap;
        }

        /* Mobile Sidebar */
        #mobile-sidebar {
            background: linear-gradient(145deg, #ffffff, #f9fafb);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            z-index: 1001; /* Above navbar */
        }
        .mobile-sidebar-item {
            display: block;
            padding: 0.75rem 1rem;
            font-size: 1.1rem;
            font-weight: 500;
            color: #4b5563;
            transition: all 0.3s ease;
            border-radius: 6px;
        }
        .mobile-sidebar-item:hover, .mobile-sidebar-item.active {
            color: #d97706;
            background-color: #f3f4f6;
            transform: translateX(5px);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 2000; /* Increased to ensure modals are above dropdowns */
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .modal.open {
            display: flex;
            opacity: 1;
        }
        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            transform: translateY(-50px);
            transition: transform 0.3s ease;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        .modal.open .modal-content {
            transform: translateY(0);
        }
        .modal-close {
            position: absolute;
            top: 12px;
            right: 12px;
            color: #6b7280;
            cursor: pointer;
            transition: color 0.3s ease;
        }
        .modal-close:hover {
            color: #d97706;
        }

        /* Card Styles */
        .custom-card {
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 2px solid transparent;
        }
        .custom-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
            border-color: #d97706;
        }

        /* Profile Card */
        .profile-card {
            background: linear-gradient(145deg, #ffffff, #f9fafb);
            border: 2px solid transparent;
            border-image: linear-gradient(to right, #d97706, #facc15) 1;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
        }
        .profile-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);
        }
        .profile-pic-container {
            position: relative;
            overflow: hidden;
            border-radius: 50%;
            border: 4px solid #d97706;
            transition: transform 0.3s ease, border-color 0.3s ease;
            width: 128px;
            height: 128px;
        }
        .profile-pic-container:hover {
            transform: scale(1.1);
            border-color: #facc15;
        }
        .profile-pic-container img {
           object-fit: cover !important;
  width: 100% !important;
  height: 100% !important;
  border-radius: 50% !important;
        }

        /* Table Styles */
        .table-container {
            overflow-x: auto;
        }
        .table {
            width: 100%;
            border-collapse: collapse;
            background: #ffffff;
            border-radius: 8px;
            overflow: hidden;
        }
        .table th, .table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        .table th {
            background: #f9fafb;
            font-weight: 600;
            color: #1f2937;
        }
        .table tr:nth-child(even) {
            background: #f9fafb;
        }
        .table tr:hover {
            background: #f3f4f6;
        }
        .table img {
            width: 80px;
            height: 80px;
            object-fit: contain; /* Show full image */
            max-width: 100%;
            max-height: 100%;
            border-radius: 4px;
        }
        .table .action-btn {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            border-radius: 6px;
            transition: background-color 0.3s ease, transform 0.3s ease;
            display: inline-block;
        }
        .action-btn.bg-red-600 {
    background-color: #dc2626;
    color: #ffffff;
}

.action-btn.bg-red-600:hover {
    background-color: #b91c1c;
    transform: scale(1.05);
}
        .table .action-btn:hover {
            transform: scale(1.05);
        }

        /* Wishlist and Cart Cards */
        .wishlist-card, .cart-card {
            border: 2px solid #e5e7eb;
        }
        .wishlist-card:hover, .cart-card:hover {
            border-color: #d97706;
        }
        .wishlist-card img, .cart-card img {
            border-radius: 8px;
            transition: transform 0.3s ease;
        }
        .wishlist-card:hover img, .cart-card:hover img {
            transform: scale(1.05);
        }
        .action-btn {
            transition: background-color 0.3s ease, transform 0.3s ease;
        }
        .action-btn:hover {
            transform: scale(1.05);
        }

        /* Total Card */
        .total-card {
            background: linear-gradient(145deg, #fef3c7, #fef9c3);
            border: 2px solid #d97706;
            border-radius: 8px;
        }

        /* Radio Button Styles */
        .radio-group {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        .radio-group input[type="radio"] {
            accent-color: #d97706;
        }

        /* Checkout Modal */
        #checkout-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            overflow-y: auto;
            z-index: 2000; /* Above dropdowns */
            display: none;
            align-items: flex-start;
            justify-content: center;
            padding: 0;
        }
        #checkout-modal.open {
            display: flex;
        }
        #checkout-modal .modal-content {
            max-height: 80vh;
            overflow-y: auto;
            margin: 1rem auto;
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            width: 100%;
            max-width: 500px;
        }
        
        #checkout-modal .custom-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }
        @media (max-width: 767px) {
            #checkout-modal {
                padding: 0;
            }
            #checkout-modal .modal-content {
                margin: 0.5rem 0;
                padding: 1rem;
                max-height: 70vh;
                width: 100%;
            }
            #checkout-modal .custom-card {
                margin-top: 1rem;
                width: 100%;
            }
            .floating-text {
                padding: 3px 6px;
                font-size: 9px;
            }
            #mobile-country-btn-container button {
                padding: 0.5rem 0.75rem;
                font-size: 0.75rem;
                min-width: 60px;
                z-index: 1002;
            }
            #mobile-country-btn-container #mobile-country-dropdown {
                width: 100px;
                padding: 0.5rem;
            }
            #mobile-country-btn-container #mobile-country-dropdown a {
                font-size: 0.75rem;
            }
            .profile-pic-container {
                width: 100px !important;
                height: 100px !important;
            }
            .table img {
                width: 60px;
                height: 60px;
            }
        }
        @media (min-width: 768px) {
            #checkout-modal {
                align-items: center;
                padding: 0;
            }
            #checkout-modal > div {
                display: flex;
                flex-direction: row;
                align-items: flex-start;
                gap: 2rem;
                max-width: 1000px;
                margin: 0 auto;
            }
            #checkout-modal .modal-content {
                margin: 0;
                padding: 2rem;
                max-height: 90vh;
                width: 500px;
            }
            #checkout-modal .custom-card {
                width: 340px;
                margin-top: 0;
                flex-shrink: 0;
            }
        }

        /* Password Toggle Icon */
        .password-toggle {
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #6b7280;
            transition: color 0.3s ease;
        }
        .password-toggle:hover {
            color: #d97706;
        }

        /* Responsive Adjustments */
        @media (max-width: 767px) {
            .grid-cols-1-2 {
                grid-template-columns: 1fr;
            }
            .modal-content {
                width: 100%;
                padding: 1.5rem;
            }
            .radio-group {
                flex-direction: column;
                align-items: flex-start;
            }
            .navbar {
                padding: 0.5rem 0;
            }
            .navbar-logo {
                height: 48px;
            }
        }
        @media (min-width: 768px) and (max-width: 1023px) {
            .grid-cols-1-2 {
                grid-template-columns: 1fr;
            }
            .navbar-item {
                padding: 0.5rem 0.75rem;
                font-size: 1rem;
            }
            .navbar-logo {
                height: 56px;
            }
        }
        @media (min-width: 1024px) {
            .navbar-logo {
                height: 64px;
            }
        }

        /* General Layout */
        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        section {
            width: 100%;
            margin: 0;
            padding: 5rem 0;
        }
        footer {
            width: 100%;
            margin: 0;
            padding: 3rem 0;
            background: linear-gradient(145deg, #1f2937, #111827);
        }

        /* Hero Section */
        section.hero {
            width: 100%;
            margin: 0;
            padding: 0;
            background: linear-gradient(to bottom, rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('{{ url_for('static', filename='images/pot1.jpg') }}') center/cover no-repeat;
            z-index: 10; /* Below navbar and dropdowns */
        }

        /* Profile Section */
        section.bg-gray-100 {
            width: 100%;
            margin: 0;
            padding: 5rem 0;
            background: linear-gradient(145deg, #f3f4f6, #e5e7eb);
            z-index: 10; /* Below navbar and dropdowns */
        }
        section.bg-gray-100 .max-w-7xl {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        /* Footer */
        footer.bg-black {
            width: 100%;
            margin: 0;
            padding: 3rem 0;
            z-index: 10; /* Below navbar and dropdowns */
        }
        footer .max-w-7xl {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        /* Floating Payment Details Card */
.custom-card.payment-details-card {
    background: white;
    border-radius: 8px;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
    z-index: 20; /* Ensure it’s above other modal content */
    width: 100%;
    max-width: 340px;
    margin-top: 1rem;
}
@media (min-width: 768px) {
    .custom-card.payment-details-card {
        position: sticky;
        top: 1rem;
        right: 0;
        margin-top: 0;
        width: 340px;
        flex-shrink: 0;
    }
}
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <!-- Navbar -->
    <nav class="navbar bg-white shadow-md fixed w-full z-1000">
        <div class="container mx-auto px-4 py-3 flex items-center justify-between">
            <!-- Mobile Navbar -->
            <div class="md:hidden flex items-center justify-between w-full relative">
                <button id="nav-toggler" class="text-2xl" aria-label="Toggle mobile menu">
                    <i class="fas fa-bars"></i>
                </button>
                <img loading="lazy" src="{{ url_for('static', filename='images/logo.png') }}" alt="Zira Artifacts Logo" class="h-12 navbar-logo">
                <div class="flex items-center space-x-2 relative">
                    <i id="mobile-search-icon" class="fas fa-search text-gray-700 hover:text-gray-900 cursor-pointer" aria-label="Toggle search"></i>
                    <a href="{{ url_for('account') }}" class="fas fa-shopping-cart text-gray-700 hover:text-gray-900" aria-label="View cart"></a>
                    <!-- Mobile Currency Button -->
                    <div id="mobile-country-btn-container" class="relative z-1002">
                        <button id="mobile-country-btn" class="bg-white text-gray-700 px-3 py-1 rounded-full shadow-lg hover:bg-gray-100 transition flex items-center text-sm" aria-label="Select currency">
                            <span class="floating-text">Currency</span>
                            <span class="flag">🇺🇸</span> USA
                        </button>
                        <div id="mobile-country-dropdown" class="hidden absolute bg-white shadow-md rounded-md p-2 w-32 mt-2 right-0 z-1004">
                            <a href="#" class="block py-1 hover:text-gray-900 country-option text-sm" data-country="USA" data-currency="USD" data-flag="🇺🇸"><span class="text-sm mr-2">🇺🇸</span>USA</a>
                            <a href="#" class="block py-1 hover:text-gray-900 country-option text-sm" data-country="Germany" data-currency="EUR" data-flag="🇩🇪"><span class="text-sm mr-2">🇩🇪</span>Germany</a>
                            <a href="#" class="block py-1 hover:text-gray-900 country-option text-sm" data-country="UK" data-currency="GBP" data-flag="🇬🇧"><span class="text-sm mr-2">🇬🇧</span>UK</a>
                            <a href="#" class="block py-1 hover:text-gray-900 country-option text-sm" data-country="Kenya" data-currency="KES" data-flag="🇰🇪"><span class="text-sm mr-2">🇰🇪</span>Kenya</a>
                        </div>
                    </div>
                </div>
                <!-- Mobile Search Bar -->
                <div id="mobile-search-bar" class="bg-white shadow-md rounded px-3 py-1 hidden">
                    <input type="text" placeholder="Search artifacts & cultural items" class="w-full outline-none text-gray-700 search-input">
                </div>
            </div>

            <!-- Desktop Navbar -->
            <div class="hidden md:flex items-center justify-between w-full">
                <img loading="lazy" src="{{ url_for('static', filename='images/logo.png') }}" alt="Zira Artifacts Logo" class="h-12 navbar-logo">
                <div class="flex space-x-6">
                    <div class="relative nav-hover">
                        <a href="{{ url_for('index') }}" class="navbar-item text-gray-700">Home</a>
                    </div>
                    <div class="relative nav-hover">
                        <a href="{{ url_for('our_products') }}" class="navbar-item text-gray-700">Products</a>
                    </div>
                    <div class="relative nav-hover">
                        <a href="{{ url_for('discounted_artefacts') }}" class="navbar-item text-gray-700">Special Discount</a>
                    </div>
                </div>
                <!-- Search and Icons -->
                <div class="flex items-center space-x-4 relative">
                    <div class="search-container">
                        <input type="text" placeholder="Search artifacts & cultural items" class="border rounded px-3 py-1 search-input">
                        <i class="fas fa-search"></i>
                    </div>
                    <a href="{{ url_for('account') }}" class="fas fa-heart text-gray-700 hover:text-gray-900" aria-label="View wishlist"></a>
                    <a href="{{ url_for('account') }}" class="fas fa-shopping-cart text-gray-700 hover:text-gray-900" aria-label="View cart"></a>
                    <!-- Desktop Currency Button -->
                    <div id="country-btn-container" class="relative z-1002">
                        <button id="country-btn" class="bg-white text-gray-700 px-3 py-1 rounded-full shadow-lg hover:bg-gray-100 transition flex items-center text-sm" aria-label="Select currency">
                            <span class="floating-text">Currency</span>
                            <span class="flag">🇺🇸</span> USA
                        </button>
                        <div id="country-dropdown" class="hidden absolute bg-white shadow-md rounded-md p-2 w-32 mt-2 right-0 z-1004">
                            <a href="#" class="block py-1 hover:text-gray-900 country-option text-sm" data-country="USA" data-currency="USD" data-flag="🇺🇸"><span class="text-sm mr-2">🇺🇸</span>USA</a>
                            <a href="#" class="block py-1 hover:text-gray-900 country-option text-sm" data-country="Germany" data-currency="EUR" data-flag="🇩🇪"><span class="text-sm mr-2">🇩🇪</span>Germany</a>
                            <a href="#" class="block py-1 hover:text-gray-900 country-option text-sm" data-country="UK" data-currency="GBP" data-flag="🇬🇧"><span class="text-sm mr-2">🇬🇧</span>UK</a>
                            <a href="#" class="block py-1 hover:text-gray-900 country-option text-sm" data-country="Kenya" data-currency="KES" data-flag="🇰🇪"><span class="text-sm mr-2">🇰🇪</span>Kenya</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Mobile Sidebar -->
    <div id="mobile-sidebar" class="fixed inset-y-0 left-0 w-64 bg-white shadow-lg transform -translate-x-full transition-transform z-1001">
        <div class="p-4">
            <button id="close-sidebar" class="text-2xl mb-4"><i class="fas fa-times"></i></button>
            <div class="space-y-2" style="padding-top: 20px;">
                <a href="{{ url_for('index') }}" class="mobile-sidebar-item">Home</a>
                <a href="{{ url_for('our_products') }}" class="mobile-sidebar-item">Products</a>
                <a href="{{ url_for('discounted_artefacts') }}" class="mobile-sidebar-item">Special Discount</a>
                <a href="{{ url_for('account') }}" class="mobile-sidebar-item active">My Account</a>
            </div>
        </div>
    </div>

    <!-- Hero Section -->
    <section class="relative h-72 bg-cover bg-center animate-zoomIn hero">
        <div class="absolute inset-0 bg-black bg-opacity-60 flex items-center justify-center">
            <h1 class="text-4xl md:text-5xl font-bold text-white animate-fadeIn">My Account</h1>
        </div>
    </section>

    <!-- Profile Section -->
    <section class="py-20 bg-gray-100">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 lg:grid-cols-1-2 gap-8">
                <!-- Profile Info -->
                <div class="custom-card profile-card p-8 animate-slideIn delay-[100ms]">
                    <div class="flex flex-col sm:flex-row items-center gap-6 mb-8">
                        <div class="profile-pic-container w-32 h-32">
                            <img loading="lazy" src="{{ url_for('static', filename='uploads/' ~ user.profile_picture) if user.profile_picture else 'https://via.placeholder.com/150' }}" alt="Profile Picture" id="profile-pic" class="object-contain w-full h-full">
                        </div>
                        <div class="text-center sm:text-left">
                            <h2 class="text-3xl font-bold text-gray-800">{{ user.name }}</h2>
                            <p class="text-gray-600 text-lg">{{ user.email }}</p>
                            <p class="text-gray-600 text-lg">{{ user.phone_number or 'No phone number' }}</p>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <button class="action-btn bg-yellow-600 text-white px-6 py-3 rounded-lg hover:bg-yellow-700 text-lg font-medium" onclick="openModal('profile-modal')">Update Profile</button>
                        <button class="action-btn bg-yellow-600 text-white px-6 py-3 rounded-lg hover:bg-yellow-700 text-lg font-medium" onclick="openModal('picture-modal')">Change Picture</button>
                        <button class="action-btn bg-yellow-600 text-white px-6 py-3 rounded-lg hover:bg-yellow-700 text-lg font-medium" onclick="openModal('address-modal')">Add Address</button>
                        <button class="action-btn bg-yellow-600 text-white px-6 py-3 rounded-lg hover:bg-yellow-700 text-lg font-medium" id="change-password-btn" onclick="openModal('password-modal')">Change Password</button>
                        <a href="{{ url_for('user_logout') }}" class="action-btn bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 text-lg font-medium text-center">Logout</a>
                    </div>
                </div>

                <!-- Wishlist, Cart, and Orders -->
                <div class="space-y-8 animate-slideIn delay-[200ms]">
                    <!-- Wishlist -->
                    <div class="custom-card p-6">
                        <h3 class="text-2xl font-semibold text-gray-800 mb-4">Wishlist</h3>
                        <div id="wishlist-items" class="table-container">
                            {% if wishlist_items %}
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Image</th>
                                        <th>Product</th>
                                        <th>Price</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for item in wishlist_items %}
                                        {% if item.product %}
                                            <tr class="wishlist-card" data-wishlist-id="{{ item.id }}">
                                                <td>
                                                    <img loading="lazy" src="{{ url_for('static', filename='uploads/' + item.product.image) | default('https://via.placeholder.com/80x80') }}" alt="{{ item.product.name }}">
                                                </td>
                                                <td>
                                                    <h3 class="text-lg font-semibold text-gray-800">{{ item.product.name }}</h3>
                                                </td>
                                                <td>
                                                    {% if item.product.discount and item.product.discount.percent > 0 %}
                                                        <p class="text-gray-600 price text-base" data-price="{{ item.product.price }}" data-discounted-price="{{ (item.product.price * (1 - item.product.discount.percent / 100)) | round(2) }}" data-has-discount="true">{{ current_currency }} {{ (item.product.price * (1 - item.product.discount.percent / 100)) | round(2) }}</p>
                                                        <p class="text-gray-500 line-through text-sm" data-original-price="{{ item.product.price }}">{{ current_currency }} {{ item.product.price }}</p>
                                                    {% else %}
                                                        <p class="text-gray-600 price text-base" data-price="{{ item.product.price }}" data-has-discount="false">{{ current_currency }} {{ item.product.price }}</p>
                                                    {% endif %}
                                                </td>
                                                <td>
                                                    <div class="flex gap-3">
                                                        <button class="text-red-500 hover:text-red-700" onclick="removeFromWishlist({{ item.id }})"><i class="fas fa-trash text-lg"></i></button>
                                                        <button class="action-btn bg-yellow-600 text-white px-3 py-1 rounded-lg hover:bg-yellow-700" onclick="addToCartFromWishlist({{ item.id }}, {{ item.product.id }})"><i class="fas fa-cart-plus text-lg"></i></button>
                                                    </div>
                                                </td>
                                            </tr>
                                        {% else %}
                                            <tr class="wishlist-card">
                                                <td colspan="4">
                                                    <p class="text-gray-600">Product not found (ID: {{ item.product_id }})</p>
                                                    <button class="text-red-500 hover:text-red-700" onclick="removeFromWishlist({{ item.id }})"><i class="fas fa-trash text-lg"></i></button>
                                                </td>
                                            </tr>
                                        {% endif %}
                                    {% endfor %}
                                </tbody>
                            </table>
                            {% else %}
                                <div class="custom-card p-6">
                                    <p class="text-gray-600 text-lg">Your wishlist is empty.</p>
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Cart -->
                    <div class="custom-card p-6">
                        <h3 class="text-2xl font-semibold text-gray-800 mb-4">Cart</h3>
                        <div id="cart-items" class="table-container">
                            {% if cart_items %}
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Image</th>
                                        <th>Product</th>
                                        <th>Price</th>
                                        <th>Quantity</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for item in cart_items %}
                                        <tr class="cart-card" data-product-id="{{ item.product_id }}">
                                            <td>
                                                <img loading="lazy" src="{{ url_for('static', filename='uploads/' + item.product.image) | default('https://via.placeholder.com/80x80') }}" alt="{{ item.product.name }}">
                                            </td>
                                            <td>
                                                <h3 class="text-lg font-semibold text-gray-800">{{ item.product.name }}</h3>
                                            </td>
                                            <td>
                                                {% if item.product.discount and item.product.discount.percent > 0 %}
                                                    <p class="text-gray-600 price text-base" data-price="{{ item.product.price }}" data-discounted-price="{{ (item.product.price * (1 - item.product.discount.percent / 100)) | round(2) }}">{{ current_currency }} {{ (item.product.price * (1 - item.product.discount.percent / 100)) | round(2) }}</p>
                                                    <p class="text-gray-500 line-through text-sm" data-original-price="{{ item.product.price }}">{{ current_currency }} {{ item.product.price }}</p>
                                                {% else %}
                                                    <p class="text-gray-600 price text-base" data-price="{{ item.product.price }}">{{ current_currency }} {{ item.product.price }}</p>
                                                {% endif %}
                                            </td>
                                            <td>
                                                <div class="flex items-center gap-2">
                                                    <button class="action-btn bg-gray-300 text-gray-800 px-2 py-1 rounded hover:bg-gray-400" onclick="updateCartQuantity({{ item.product_id }}, {{ item.quantity - 1 }})"><i class="fas fa-minus"></i></button>
                                                    <input type="number" class="w-16 p-1 border rounded text-center" value="{{ item.quantity }}" min="1" onchange="updateCartQuantity({{ item.product_id }}, this.value)">
                                                    <button class="action-btn bg-gray-300 text-gray-800 px-2 py-1 rounded hover:bg-gray-400" onclick="updateCartQuantity({{ item.product_id }}, {{ item.quantity + 1 }})"><i class="fas fa-plus"></i></button>
                                                </div>
                                            </td>
                                            <td>
                                                <button class="text-red-500 hover:text-red-700" onclick="removeFromCart({{ item.product_id }})"><i class="fas fa-trash text-lg"></i></button>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                            {% else %}
                                <div class="custom-card p-6">
                                    <p class="text-gray-600 text-lg">Your cart is empty.</p>
                                </div>
                            {% endif %}
                        </div>
                        <div class="total-card mt-6 p-6 flex flex-col sm:flex-row justify-between items-center gap-4">
                            <p class="text-xl font-semibold text-gray-800">Total: <span id="cart-total">{{ current_currency }} 0.00</span></p>
                            <button onclick="openModal('checkout-modal')" class="action-btn bg-yellow-600 text-white px-6 py-3 rounded-lg hover:bg-yellow-700 text-lg font-medium">Proceed to Checkout</button>
                        </div>
                    </div>

                    <!-- Orders -->
<div class="custom-card p-6">
    <h3 class="text-2xl font-semibold text-gray-800 mb-4">My Orders</h3>
    <div id="order-items" class="table-container">
        {% if orders %}
        <table class="table">
            <thead>
                <tr>
                    <th>Order ID</th>
                    <th>Date</th>
                    <th>Total</th>
                    <th>Status</th>
                    <th>Items</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for order in orders %}
                    <tr class="order-card">
                        <td>#{{ order.id }}</td>
                        <td>
                            {% if order.created_at %}
                                {{ order.created_at.strftime('%Y-%m-%d') }}
                            {% else %}
                                Unknown
                            {% endif %}
                        </td>
                        <td>
                            <span class="price" data-price="{{ order.total }}">{{ current_currency }} {{ order.total }}</span>
                        </td>
                        <td>{{ order.status }}</td>
                        <td>
                            {% for item in order.order_items %}
                                <div class="flex items-center gap-2 mb-2">
                                    {% if item.product %}
                                        <img loading="lazy" src="{{ url_for('static', filename='uploads/' + item.product.image) | default('https://via.placeholder.com/40x40') }}" alt="{{ item.product.name }}" class="w-10 h-10 object-contain rounded">
                                        <div>
                                            <p class="text-sm font-medium text-gray-800">{{ item.product.name }}</p>
                                            <p class="text-xs text-gray-600">Qty: {{ item.quantity }}</p>
                                        </div>
                                    {% else %}
                                        <p class="text-sm text-gray-600">Product not found (ID: {{ item.product_id }})</p>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </td>
                        <td>
                            {% if order.status|lower|trim == 'pending' %}
                                <button class="action-btn bg-red-600 text-white px-4 py-1 rounded-lg hover:bg-red-700" onclick="cancelOrder({{ order.id }})">Cancel</button>
                            {% else %}
                                <span>No action available</span>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
            <div class="custom-card p-6">
                <p class="text-gray-600 text-lg">You have no orders.</p>
            </div>
        {% endif %}
    </div>
</div>

</div>
            </div>
        </div>
    </section>

    <!-- Modals -->
    <!-- Update Profile Modal -->
    <div id="profile-modal" class="modal">
        <div class="modal-content relative">
            <span class="modal-close" onclick="closeModal('profile-modal')"><i class="fas fa-times"></i></span>
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">Update Profile</h2>
            <form id="profile-form" class="space-y-4" onsubmit="updateProfile(event)">
                <div>
                    <label class="block text-gray-700 mb-1">Full Name</label>
                    <input type="text" name="name" value="{{ user.name }}" class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-yellow-600">
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">Email</label>
                    <input type="email" name="email" value="{{ user.email }}" class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-yellow-600">
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">Phone Number</label>
                    <input type="tel" name="phone_number" value="{{ user.phone_number | default('') }}" class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-yellow-600">
                </div>
                <button type="submit" class="action-btn bg-yellow-600 text-white px-4 py-2 rounded w-full hover:bg-yellow-700">Save Changes</button>
            </form>
        </div>
    </div>

    <!-- Change Profile Picture Modal -->
    <div id="picture-modal" class="modal">
        <div class="modal-content relative">
            <span class="modal-close" onclick="closeModal('picture-modal')"><i class="fas fa-times"></i></span>
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">Change Profile Picture</h2>
            <form id="picture-form" class="space-y-4" enctype="multipart/form-data">
                <div>
                    <label class="block text-gray-700 mb-1">Upload Image</label>
                    <input type="file" accept="image/*" name="image" class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-yellow-600">
                </div>
                <button type="submit" class="action-btn bg-yellow-600 text-white px-4 py-2 rounded w-full hover:bg-yellow-700">Upload Picture</button>
            </form>
        </div>
    </div>

    <!-- Add Address Modal -->
    <div id="address-modal" class="modal">
        <div class="modal-content relative">
            <span class="modal-close" onclick="closeModal('address-modal')"><i class="fas fa-times"></i></span>
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">Add Address</h2>
            <form id="address-form" class="space-y-4">
                <div>
                    <label class="block text-gray-700 mb-1">Street Address</label>
                    <input type="text" name="street" value="{{ address.street | default('') }}" class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-yellow-600">
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">City</label>
                    <input type="text" name="city" value="{{ address.city | default('') }}" class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-yellow-600">
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">Country</label>
                    <select name="country" class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-yellow-600">
                        <option value="Kenya" {{ 'selected' if address.country == 'Kenya' }}>Kenya</option>
                        <option value="USA" {{ 'selected' if address.country == 'USA' }}>USA</option>
                        <option value="Germany" {{ 'selected' if address.country == 'Germany' }}>Germany</option>
                        <option value="UK" {{ 'selected' if address.country == 'UK' }}>UK</option>
                    </select>
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">Postal Code</label>
                    <input type="text" name="postal_code" value="{{ address.postal_code | default('') }}" class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-yellow-600">
                </div>
                <button type="submit" class="action-btn bg-yellow-600 text-white px-4 py-2 rounded w-full hover:bg-yellow-700">Save Address</button>
            </form>
        </div>
    </div>

   <div id="checkout-modal" class="modal">
    <div class="relative flex flex-col md:flex-row items-start justify-center max-w-5xl mx-auto p-4 gap-4">
        <!-- Modal Content -->
        <div class="modal-content relative bg-white rounded-lg p-6 w-full max-w-lg animate-slideIn delay-[200ms] z-10">
            <span class="modal-close" onclick="closeModal('checkout-modal')"><i class="fas fa-times"></i></span>
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">Checkout</h2>
            <form id="checkout-form" class="space-y-4" onsubmit="placeOrder(event)">
                <div>
                    <label class="block text-gray-700 mb-1">Full Name</label>
                    <input type="text" name="name" value="{{ user.name }}" class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-yellow-600" required>
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">Phone Number</label>
                    <input type="tel" name="phone_number" value="{{ user.phone_number | default('') }}" class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-yellow-600" required>
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">Street Address</label>
                    <input type="text" name="street" value="{{ address.street | default('') }}" class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-yellow-600" required>
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">City</label>
                    <input type="text" name="city" value="{{ address.city | default('') }}" class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-yellow-600" required>
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">Country</label>
                    <select name="country" class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-yellow-600" required>
                        <option value="USA" {{ 'selected' if address.country == 'USA' }}>USA</option>
                        <option value="Germany" {{ 'selected' if address.country == 'Germany' }}>Germany</option>
                        <option value="UK" {{ 'selected' if address.country == 'UK' }}>UK</option>
                        <option value="Kenya" {{ 'selected' if address.country == 'Kenya' }}>Kenya</option>
                    </select>
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">Postal Code</label>
                    <input type="text" name="postal_code" value="{{ address.postal_code | default('') }}" class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-yellow-600" required>
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">Payment Method</label>
                    <div class="radio-group">
                        <label class="flex items-center">
                            <input type="radio" name="payment_method" value="immediate" class="mr-2" disabled>
                            Pay Immediately
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="payment_method" value="delivery" class="mr-2" checked>
                            Pay on Delivery
                        </label>
                    </div>
                </div>
                <div id="message-code-section" class="hidden">
                    <label class="block text-gray-700 mb-1">Message Code</label>
                    <input type="text" name="message_code" class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-yellow-600" disabled>
                </div>
                <div class="flex gap-4">
                    <button type="submit" class="action-btn bg-yellow-600 text-white px-4 py-2 rounded flex-1 hover:bg-yellow-700">Place Order</button>
                    <button type="button" id="cancel-checkout-btn" class="action-btn bg-gray-500 text-white px-4 py-2 rounded flex-1 hover:bg-gray-600">Cancel</button>
                </div>
            </form>
        </div>
        <!-- Floating Payment Details Card -->
        <div class="custom-card payment-details-card p-6 bg-white rounded-lg shadow-lg w-full max-w-md mt-4 animate-slideIn delay-[100ms]">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">Payment Details (Currently not available. Only pay on Delivery at the moment)</h3>
            <div id="payment-details" class="space-y-4">
                <div id="immediate-payment-details" class="hidden">
                    <div class="mb-4">
                        <h4 class="text-lg font-medium text-gray-700">Contact Us</h4>
                        <p class="text-gray-600 text-sm">Email: <a href="mailto:vickiebmochama@gmail.com" class="text-yellow-600 hover:underline">vickiebmochama@gmail.com</a></p>
                        <p class="text-gray-600 text-sm mt-1">Thank you</p>
                    </div>
                    <div>
                        <h4 class="text-lg font-medium text-gray-700">Bank Transfer</h4>
                        <p class="text-gray-600 text-sm">Bank: Zira Bank</p>
                        <p class="text-gray-600 text-sm">Account: </p>
                        <p class="text-gray-600 text-sm">SWIFT: </p>
                        <p class="text-gray-600 text-sm mt-1">Reference: </p>
                    </div>
                </div>
                <div id="delivery-payment-details">
                    <p class="text-gray-600 text-sm">Payment will be collected upon delivery.</p>
                    <p class="text-gray-600 text-sm mt-1">Please ensure you have cash or a valid payment method available when your order arrives.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Change Password Modal -->
    <div id="password-modal" class="modal">
        <div class="modal-content relative">
            <span class="modal-close" onclick="closeModal('password-modal')"><i class="fas fa-times"></i></span>
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">Change Password</h2>
            <form id="password-form" class="space-y-4" onsubmit="changePassword(event)">
                <div class="relative">
                    <label class="block text-gray-700 mb-1">Old Password</label>
                    <input type="password" name="old_password" id="old-password" class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-yellow-600" required autocomplete="current-password">
                    <i class="fas fa-eye password-toggle" onclick="togglePassword('old-password')"></i>
                </div>
                <div class="relative">
                    <label class="block text-gray-700 mb-1">New Password</label>
                    <input type="password" name="new_password" id="new-password" class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-yellow-600" required autocomplete="new-password">
                    <i class="fas fa-eye password-toggle" onclick="togglePassword('new-password')"></i>
                </div>
                <div class="relative">
                    <label class="block text-gray-700 mb-1">Confirm New Password</label>
                    <input type="password" name="confirm_password" id="confirm-password" class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-yellow-600" required autocomplete="new-password">
                    <i class="fas fa-eye password-toggle" onclick="togglePassword('confirm-password')"></i>
                </div>
                <button type="submit" id="change-password-submit" class="action-btn bg-yellow-600 text-white px-4 py-2 rounded w-full hover:bg-yellow-700">Change Password</button>
            </form>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-black text-white py-12 px-6">
        <div class="max-w-7xl mx-auto">
            <!-- Desktop Layout -->
            <div class="hidden md:grid grid-cols-5 gap-8 text-sm">
                <!-- Shop -->
                <div>
                    <h3 class="text-yellow-600 font-semibold mb-3">Shop</h3>
                    <ul class="space-y-2">
                        <li><a href="{{ url_for('our_products') }}" class="text-white hover:text-yellow-400">Artifact Collections</a></li>
                        <li><a href="{{ url_for('account') }}" class="text-white hover:text-yellow-400">Track My Order</a></li>
                    </ul>
                </div>
                <!--名称 -->
                <div>
                    <h3 class="text-yellow-600 font-semibold mb-3">Sell</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-white hover:text-yellow-400">Sell on Zira Artifacts</a></li>
                        <li><a href="#" class="text-white hover:text-yellow-400">Artisan Seller FAQ</a></li>
                    </ul>
                </div>
                <!-- Policies -->
                <div>
                    <h3 class="text-yellow-600 font-semibold mb-3">Policies</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-white hover:text-yellow-400">Return & Refund Policy</a></li>
                        <li><a href="#" class="text-white hover:text-yellow-400">Privacy & Sharing</a></li>
                    </ul>
                </div>
                <!-- Company -->
                <div>
                    <h3 class="text-yellow-600 font-semibold mb-3">Company</h3>
                    <ul class="space-y-2">
                        <li><a href="{{ url_for('index') }}" class="text-white hover:text-yellow-400">About Us</a></li>
                        <li><a href="{{ url_for('index') }}" class="text-white hover:text-yellow-400">Contact Us</a></li>
                        <li><a href="{{ url_for('login') }}" class="text-white hover:text-yellow-400">Admin</a></li>
                        <li class="mt-4 text-white font-medium">+254701539003</li>
                        <li>vickiebmochama@gmail.com</li>
                        <li class="flex gap-4 mt-2 text-xl">
                            <a href="#"><i class="fab fa-pinterest"></i></a>
                            <a href="#"><i class="fab fa-facebook"></i></a>
                            <a href="#"><i class="fab fa-instagram"></i></a>
                            <a href="#"><i class="fab fa-youtube"></i></a>
                            <a href="#"><i class="fab fa-whatsapp"></i></a>
                        </li>
                    </ul>
                </div>
                <!-- Subscribe -->
                <div>
                    <h3 class="text-yellow-600 font-semibold mb-3">Let’s Get in Touch</h3>
                    <p class="text-sm mb-3">Sign up to subscribe and receive 5% off your artifact order</p>
                    <form class="flex items-center border rounded-md overflow-hidden bg-white text-black">
                        <input type="email" placeholder="Enter your email" class="px-3 py-2 w-full focus:outline-none">
                        <button type="submit" class="px-3 py-2 text-white bg-yellow-600 hover:bg-yellow-700 transition"><i class="fas fa-arrow-right"></i></button>
                    </form>
                    <div class="mt-2 flex items-start gap-2">
                        <input type="checkbox" class="mt-1">
                        <p class="text-xs">I agree with the <a href="#" class="underline">Terms & Conditions</a></p>
                    </div>
                </div>
            </div>
            <!-- Mobile Dropdowns -->
            <div class="md:hidden space-y-4">
                <!-- Shop -->
                <details class="bg-gray-900 rounded-md p-4">
                    <summary class="text-yellow-500 font-semibold cursor-pointer">Shop</summary>
                    <ul class="grid grid-cols-2 gap-x-4 gap-y-2 mt-3 text-sm">
                        <li><a href="{{ url_for('our_products') }}" class="text-white hover:text-yellow-400">Artifact Collections</a></li>
                        <li><a href="{{ url_for('account') }}" class="text-white hover:text-yellow-400">Track My Order</a></li>
                    </ul>
                </details>
                <!-- Sell -->
                <details class="bg-gray-900 rounded-md p-4">
                    <summary class="text-yellow-500 font-semibold cursor-pointer">Sell</summary>
                    <ul class="grid grid-cols-2 gap-x-4 gap-y-2 mt-3 text-sm">
                        <li><a href="#" class="text-white hover:text-yellow-400">Sell on Zira Artifacts</a></li>
                        <li><a href="#" class="text-white hover:text-yellow-400">Artisan Seller FAQ</a></li>
                    </ul>
                </details>
                <!-- Policies -->
                <details class="bg-gray-900 rounded-md p-4">
                    <summary class="text-yellow-500 font-semibold cursor-pointer">Policies</summary>
                    <ul class="grid grid-cols-2 gap-x-4 gap-y-2 mt-3 text-sm">
                        <li><a href="#" class="text-white hover:text-yellow-400">Return & Refund Policy</a></li>
                        <li><a href="#" class="text-white hover:text-yellow-400">Privacy & Sharing</a></li>
                    </ul>
                </details>
                <!-- Company -->
                <details class="bg-gray-900 rounded-md p-4">
                    <summary class="text-yellow-500 font-semibold cursor-pointer">Company</summary>
                    <ul class="grid grid-cols-2 gap-x-4 gap-y-2 mt-3 text-sm">
                        <li><a href="{{ url_for('index') }}" class="text-white hover:text-yellow-400">About Us</a></li>
                        <li><a href="{{ url_for('index') }}" class="text-white hover:text-yellow-400">Contact Us</a></li>
                        <li><a href="{{ url_for('login') }}" class="text-white hover:text-yellow-400">Admin</a></li>
                    </ul>
                    <div class="mt-3 text-sm">
                        <p>+254701539003</p>
                        <p>vickiebmochama@gmail.com</p>
                        <div class="flex gap-3 mt-2 text-xl">
                            <a href="#"><i class="fab fa-pinterest"></i></a>
                            <a href="#"><i class="fab fa-facebook"></i></a>
                            <a href="#"><i class="fab fa-instagram"></i></a>
                            <a href="#"><i class="fab fa-youtube"></i></a>
                            <a href="#"><i class="fab fa-whatsapp"></i></a>
                        </div>
                    </div>
                </details>
                <!-- Subscribe -->
                <details class="bg-gray-900 rounded-md p-4">
                    <summary class="text-yellow-500 font-semibold cursor-pointer">Let’s Get in Touch</summary>
                    <p class="text-sm mt-2">Sign up to subscribe and receive 5% off your artifact order</p>
                    <form class="flex items-center border rounded-md overflow-hidden bg-white text-black mt-2">
                        <input type="email" placeholder="Enter your email" class="px-3 py-2 w-full focus:outline-none">
                        <button type="submit" class="px-3 py-2 text-white bg-yellow-600 hover:bg-yellow-700 transition"><i class="fas fa-arrow-right"></i></button>
                    </form>
                    <div class="mt-2 flex items-start gap-2">
                        <input type="checkbox" class="mt-1">
                        <p class="text-xs">I agree with the <a href="#" class="underline">Terms & Conditions</a></p>
                    </div>
                </details>
            </div>
        </div>
    </footer>

<script>
    // Currency Conversion Logic (KES as base currency)
let exchangeRates = {
    EUR: 0.0073, // Fallback rates
    GBP: 0.0061,
    KES: 1,
    USD: 0.0077
};
let currentCurrency = '{{ current_currency | safe }}';

// API Configuration
const API_URL = '/api/exchange_rates';
const SUPPORTED_CURRENCIES = ['EUR', 'GBP', 'KES', 'USD'].sort(); // Sorted alphabetically

// Fetch Exchange Rates from Backend
async function fetchExchangeRates() {
    console.log('Fetching exchange rates from backend');
    try {
        const response = await fetch(API_URL);
        if (!response.ok) {
            console.error(`Backend error: ${response.status} ${response.statusText}`);
            throw new Error('Backend request failed');
        }
        const rates = await response.json();
        if (!rates.EUR || !rates.GBP || !rates.KES || !rates.USD) {
            console.error('Invalid backend response:', rates);
            throw new Error('Invalid backend response');
        }

        // Update exchange rates
        exchangeRates = { ...rates };
        console.log('Fetched exchange rates:', exchangeRates);
        updatePrices();
    } catch (error) {
        console.error('Error fetching exchange rates:', error);
        console.warn('Using fallback exchange rates');
        updatePrices();
    }
}

// Helper Function to Format Dates Safely
function formatDate(dateInput) {
    console.log('Formatting date:', dateInput);
    if (!dateInput) {
        console.warn('Date input is null or undefined');
        return 'Unknown';
    }

    try {
        const date = new Date(dateInput);
        if (isNaN(date.getTime())) {
            console.warn(`Invalid date: ${dateInput}`);
            return 'Unknown';
        }
        // Format as YYYY-MM-DD
        return date.toISOString().split('T')[0];
    } catch (error) {
        console.error(`Error formatting date ${dateInput}:`, error);
        return 'Unknown';
    }
}

// Toggle Country Dropdown
document.getElementById('country-btn')?.addEventListener('click', () => {
    console.log('Toggling country dropdown');
    const dropdown = document.getElementById('country-dropdown');
    if (dropdown) {
        dropdown.classList.toggle('hidden');
    } else {
        console.error('Country dropdown not found');
    }
});

// Toggle Mobile Country Dropdown
document.getElementById('mobile-country-btn')?.addEventListener('click', () => {
    console.log('Toggling mobile country dropdown');
    const dropdown = document.getElementById('mobile-country-dropdown');
    if (dropdown) {
        dropdown.classList.toggle('hidden');
    } else {
        console.error('Mobile country dropdown not found');
    }
});

// Update Currency for Mobile
document.querySelectorAll('#mobile-country-dropdown .country-option').forEach(option => {
    option.addEventListener('click', (e) => {
        console.log('Mobile currency option clicked');
        e.preventDefault();
        const country = e.target.getAttribute('data-country');
        const flag = e.target.getAttribute('data-flag');
        currentCurrency = e.target.getAttribute('data-currency');
        const countryBtn = document.getElementById('mobile-country-btn');
        if (countryBtn) {
            countryBtn.innerHTML = `<span class="floating-text">Currency</span><span class="flag">${flag}</span> ${country}`;
        }
        const dropdown = document.getElementById('mobile-country-dropdown');
        if (dropdown) {
            dropdown.classList.add('hidden');
        }
        updatePrices();
    });
});

// Update Currency
document.querySelectorAll('.country-option').forEach(option => {
    option.addEventListener('click', (e) => {
        console.log('Currency option clicked');
        e.preventDefault();
        const country = e.target.getAttribute('data-country');
        const flag = e.target.getAttribute('data-flag');
        currentCurrency = e.target.getAttribute('data-currency');
        const countryBtn = document.getElementById('country-btn');
        if (countryBtn) {
            countryBtn.innerHTML = `<span class="flag">${flag}</span> ${country}`;
        }
        const dropdown = document.getElementById('country-dropdown');
        if (dropdown) {
            dropdown.classList.add('hidden');
        }
        updatePrices();
    });
});

// Update Wishlist, Cart, and Order Prices
function updatePrices() {
    console.log('Updating prices for currency:', currentCurrency);
    let cartTotal = 0;

    // Validate currency
    if (!exchangeRates[currentCurrency]) {
        console.warn(`Invalid currency: ${currentCurrency}, defaulting to KES`);
        currentCurrency = 'KES';
    }

    // Update Wishlist Prices
    document.querySelectorAll('#wishlist-items .price').forEach(priceElement => {
        const hasDiscount = priceElement.getAttribute('data-has-discount') === 'true';
        const basePriceKES = parseFloat(priceElement.getAttribute('data-discounted-price') || priceElement.getAttribute('data-price'));

        if (isNaN(basePriceKES)) {
            console.error('Invalid base price for wishlist item:', priceElement, 'data-price:', priceElement.getAttribute('data-price'), 'data-discounted-price:', priceElement.getAttribute('data-discounted-price'));
            priceElement.textContent = `${currentCurrency} N/A`;
            return;
        }

        const convertedPrice = (basePriceKES * exchangeRates[currentCurrency]).toFixed(2);
        priceElement.textContent = `${currentCurrency} ${convertedPrice}`;
        console.log(`Wishlist item - Has discount: ${hasDiscount}, Base price (KES): ${basePriceKES}, Converted price: ${currentCurrency} ${convertedPrice}`);

        const originalPriceElement = priceElement.parentElement.querySelector('[data-original-price]');
        if (originalPriceElement) {
            const originalPriceKES = parseFloat(originalPriceElement.getAttribute('data-original-price'));
            if (isNaN(originalPriceKES)) {
                console.error('Invalid original price for wishlist item:', originalPriceElement, 'data-original-price:', originalPriceElement.getAttribute('data-original-price'));
                originalPriceElement.textContent = `${currentCurrency} N/A`;
            } else {
                const convertedOriginalPrice = (originalPriceKES * exchangeRates[currentCurrency]).toFixed(2);
                originalPriceElement.textContent = `${currentCurrency} ${convertedOriginalPrice}`;
                console.log(`Wishlist item - Original price (KES): ${originalPriceKES}, Converted original price: ${currentCurrency} ${convertedOriginalPrice}`);
            }
        }
    });

    // Update Cart Prices and Total
    document.querySelectorAll('#cart-items .price').forEach(priceElement => {
        const hasDiscount = priceElement.getAttribute('data-has-discount') === 'true';
        const basePriceKES = parseFloat(priceElement.getAttribute('data-discounted-price') || priceElement.getAttribute('data-price'));
        const quantityElement = priceElement.parentElement.querySelector('input[type="number"]');
        const quantity = quantityElement ? parseInt(quantityElement.value) : 1;

        if (isNaN(basePriceKES)) {
            console.error('Invalid base price for cart item:', priceElement, 'data-price:', priceElement.getAttribute('data-price'), 'data-discounted-price:', priceElement.getAttribute('data-discounted-price'));
            priceElement.textContent = `${currentCurrency} N/A`;
            return;
        }

        const convertedPrice = (basePriceKES * exchangeRates[currentCurrency]).toFixed(2);
        priceElement.textContent = `${currentCurrency} ${convertedPrice}`;
        cartTotal += basePriceKES * quantity;
        console.log(`Cart item - Has discount: ${hasDiscount}, Base price (KES): ${basePriceKES}, Converted price: ${currentCurrency} ${convertedPrice}`);

        const originalPriceElement = priceElement.parentElement.querySelector('[data-original-price]');
        if (originalPriceElement) {
            const originalPriceKES = parseFloat(originalPriceElement.getAttribute('data-original-price'));
            if (isNaN(originalPriceKES)) {
                console.error('Invalid original price for cart item:', originalPriceElement, 'data-original-price:', originalPriceElement.getAttribute('data-original-price'));
                originalPriceElement.textContent = `${currentCurrency} N/A`;
            } else {
                const convertedOriginalPrice = (originalPriceKES * exchangeRates[currentCurrency]).toFixed(2);
                originalPriceElement.textContent = `${currentCurrency} ${convertedOriginalPrice}`;
                console.log(`Cart item - Original price (KES): ${originalPriceKES}, Converted original price: ${currentCurrency} ${convertedOriginalPrice}`);
            }
        }
    });

    // Update Order Prices
    document.querySelectorAll('#order-items .price').forEach(priceElement => {
        const hasDiscount = priceElement.getAttribute('data-has-discount') === 'true';
        const basePriceKES = parseFloat(
            hasDiscount 
                ? priceElement.getAttribute('data-discounted-price') 
                : priceElement.getAttribute('data-price')
        );

        if (isNaN(basePriceKES)) {
            console.error('Invalid base price for order item:', priceElement, 'data-price:', priceElement.getAttribute('data-price'), 'data-discounted-price:', priceElement.getAttribute('data-discounted-price'));
            priceElement.textContent = `${currentCurrency} N/A`;
            return;
        }

        const convertedPrice = (basePriceKES * exchangeRates[currentCurrency]).toFixed(2);
        priceElement.textContent = `${currentCurrency} ${convertedPrice}`;
        console.log(`Order item - Has discount: ${hasDiscount}, Base price (KES): ${basePriceKES}, Converted price: ${currentCurrency} ${convertedPrice}`);

        const originalPriceElement = priceElement.parentElement.querySelector('[data-original-price]');
        if (originalPriceElement) {
            const originalPriceKES = parseFloat(originalPriceElement.getAttribute('data-original-price'));
            if (isNaN(originalPriceKES)) {
                console.error('Invalid original price for order item:', originalPriceElement, 'data-original-price:', originalPriceElement.getAttribute('data-original-price'));
                originalPriceElement.textContent = `${currentCurrency} N/A`;
            } else {
                const convertedOriginalPrice = (originalPriceKES * exchangeRates[currentCurrency]).toFixed(2);
                originalPriceElement.textContent = `${currentCurrency} ${convertedOriginalPrice}`;
                console.log(`Order item - Original price (KES): ${originalPriceKES}, Converted original price: ${currentCurrency} ${convertedOriginalPrice}`);
            }
        }
    });

    // Update Order Totals
    document.querySelectorAll('#order-items .price[data-price]').forEach(totalElement => {
        const baseTotalKES = parseFloat(totalElement.getAttribute('data-price'));
        if (isNaN(baseTotalKES)) {
            console.error('Invalid base total for order:', totalElement, 'data-price:', totalElement.getAttribute('data-price'));
            totalElement.textContent = `${currentCurrency} N/A`;
        } else {
            const convertedTotal = (baseTotalKES * exchangeRates[currentCurrency]).toFixed(2);
            totalElement.textContent = `${currentCurrency} ${convertedTotal}`;
            console.log(`Order total - Base total (KES): ${baseTotalKES}, Converted total: ${currentCurrency} ${convertedTotal}`);
        }
    });

    // Update Cart Total
    const cartTotalElement = document.getElementById('cart-total');
    if (cartTotalElement) {
        cartTotalElement.textContent = `${currentCurrency} ${(cartTotal * exchangeRates[currentCurrency]).toFixed(2)}`;
    }
}

// Initialize Exchange Rates on Page Load
document.addEventListener('DOMContentLoaded', () => {
    console.log('Page loaded, initializing exchange rates');
    fetchExchangeRates();
});

// Modal Functions
function openModal(modalId) {
    console.log(`Attempting to open modal: ${modalId}`);
    const modal = document.getElementById(modalId);
    if (!modal) {
        console.error(`Modal ${modalId} not found`);
        showToast(`Modal ${modalId} not found`, 'error');
        return;
    }
    modal.classList.add('open');
    document.body.style.overflow = 'hidden';
    if (modalId === 'checkout-modal') {
        updatePaymentDetails(); // Ensure payment details are updated
        toggleMessageCode(); // Hide message code section
    }
    console.log(`Modal ${modalId} opened successfully`);
}

function closeModal(modalId) {
    console.log(`Attempting to close modal: ${modalId}`);
    const modal = document.getElementById(modalId);
    if (!modal) {
        console.error(`Modal ${modalId} not found`);
        return;
    }
    modal.classList.remove('open');
    document.body.style.overflow = 'auto';
    console.log(`Modal ${modalId} closed successfully`);
}

// Update Profile
function updateProfile(event) {
    event.preventDefault();
    console.log('Updating profile');
    const form = event.target;
    const data = {
        name: form.name.value,
        email: form.email.value,
        phone_number: form.phone_number.value
    };
    fetch('/api/users/{{ user.id }}', {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
        credentials: 'include'
    })
    .then(response => response.json().then(data => ({ status: response.status, body: data })))
    .then(({ status, body }) => {
        if (status >= 400) {
            throw new Error(body.error || 'Failed to update profile');
        }
        showToast(body.message || 'User updated successfully', 'success');
        closeModal('profile-modal');
        setTimeout(() => {
            console.log('Reloading page after profile update');
            location.reload();
        }, 3000);
    })
    .catch(error => {
        console.error('Error updating profile:', error);
        showToast('Failed to update profile: ' + error.message, 'error');
        if (error.message.includes('Unauthorized')) {
            window.location.href = '{{ url_for('user_login') }}';
        }
    });
}

// Change Profile Picture
document.getElementById('picture-form')?.addEventListener('submit', (e) => {
    e.preventDefault();
    console.log('Submitting profile picture');
    const fileInput = e.target.querySelector('input[type="file"]');
    if (fileInput.files[0]) {
        const formData = new FormData();
        formData.append('image', fileInput.files[0]);
        fetch('/api/profile/picture', {
            method: 'POST',
            body: formData,
            credentials: 'include'
        })
        .then(response => response.json().then(data => ({ status: response.status, body: data })))
        .then(({ status, body }) => {
            if (status >= 400) {
                throw new Error(body.error || 'Failed to update profile picture');
            }
            if (body.image_url) {
                document.getElementById('profile-pic').src = body.image_url;
                showToast('Profile picture updated!', 'success');
            } else {
                showToast('Failed to update profile picture', 'error');
            }
            closeModal('picture-modal');
        })
        .catch(error => {
            console.error('Error uploading picture:', error);
            showToast('Failed to upload picture: ' + error.message, 'error');
            if (error.message.includes('Unauthorized')) {
                window.location.href = '{{ url_for('user_login') }}';
            }
        });
    }
});

// Add Address
document.getElementById('address-form')?.addEventListener('submit', (e) => {
    e.preventDefault();
    console.log('Adding address');
    fetch('/api/profile/address', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            street: e.target.street.value,
            city: e.target.city.value,
            country: e.target.country.value,
            postal_code: e.target.postal_code.value,
        }),
        credentials: 'include'
    })
    .then(response => response.json().then(data => ({ status: response.status, body: data })))
    .then(({ status, body }) => {
        if (status >= 400) {
            throw new Error(body.error || 'Failed to add address');
        }
        showToast(body.message || 'Address added successfully', 'success');
        closeModal('address-modal');
        setTimeout(() => {
            console.log('Reloading page after adding address');
            location.reload();
        }, 3000);
    })
    .catch(error => {
        console.error('Error adding address:', error);
        showToast('Failed to add address: ' + error.message, 'error');
        if (error.message.includes('Unauthorized')) {
            window.location.href = '{{ url_for('user_login') }}';
        }
    });
});

// Remove from Wishlist
function removeFromWishlist(wishlistId) {
    console.log(`Removing wishlist item: ${wishlistId}`);
    fetch(`/api/wishlist/${wishlistId}`, {
        method: 'DELETE',
        credentials: 'include'
    })
    .then(response => response.json().then(data => ({ status: response.status, body: data })))
    .then(({ status, body }) => {
        if (status >= 400) {
            throw new Error(body.error || 'Failed to remove from wishlist');
        }
        showToast(body.message || 'Removed from wishlist', 'success');
        setTimeout(() => {
            console.log('Reloading page after removing from wishlist');
            location.reload();
        }, 3000);
    })
    .catch(error => {
        console.error('Error removing from wishlist:', error);
        showToast('Failed to remove from wishlist: ' + error.message, 'error');
        if (error.message.includes('Unauthorized')) {
            window.location.href = '{{ url_for('user_login') }}';
        }
    });
}

// Add to Cart from Wishlist
function addToCartFromWishlist(wishlistId, productId) {
    console.log(`Adding to cart from wishlist: ${wishlistId}, product: ${productId}`);
    const wishlistCard = document.querySelector(`#wishlist-items .wishlist-card button[onclick="addToCartFromWishlist(${wishlistId}, ${productId})"]`).closest('.wishlist-card');
    const priceElement = wishlistCard.querySelector('.price');
    const discountedPriceKES = parseFloat(priceElement.getAttribute('data-discounted-price') || priceElement.getAttribute('data-price'));

    fetch('/api/cart', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ 
            product_id: productId, 
            quantity: 1,
            price: discountedPriceKES
        }),
        credentials: 'include'
    })
    .then(response => response.json().then(data => ({ status: response.status, body: data })))
    .then(({ status, body }) => {
        if (status >= 400) {
            throw new Error(body.error || 'Failed to add to cart');
        }
        return fetch(`/api/wishlist/${wishlistId}`, {
            method: 'DELETE',
            credentials: 'include'
        });
    })
    .then(response => response.json().then(data => ({ status: response.status, body: data })))
    .then(({ status, body }) => {
        if (status >= 400) {
            throw new Error(body.error || 'Failed to remove from wishlist');
        }
        showToast('Product moved to cart', 'success');
        setTimeout(() => {
            console.log('Reloading page after moving to cart');
            location.reload();
        }, 3000);
    })
    .catch(error => {
        console.error('Error moving to cart:', error);
        showToast('Failed to move product to cart: ' + error.message, 'error');
        if (error.message.includes('Unauthorized')) {
            window.location.href = '{{ url_for('user_login') }}';
        }
    });
}

// Update Cart Quantity
async function updateCartQuantity(productId, quantity) {
    console.log(`Updating cart quantity for product: ${productId}, quantity: ${quantity}`);
    if (quantity < 1) {
        showToast('Quantity must be at least 1', 'error');
        return;
    }
    const cartCard = document.querySelector(`.cart-card[data-product-id="${productId}"]`);
    const priceElement = cartCard.querySelector('.price');
    const discountedPriceKES = parseFloat(priceElement.getAttribute('data-discounted-price') || priceElement.getAttribute('data-price'));

    try {
        const response = await fetch('/api/cart', {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                product_id: productId, 
                quantity: parseInt(quantity),
                price: discountedPriceKES
            }),
            credentials: 'include'
        });
        const data = await response.json();
        if (response.ok) {
            showToast(data.message || 'Quantity updated successfully', 'success');
            setTimeout(() => {
                console.log('Reloading page after updating quantity');
                location.reload();
            }, 3000);
        } else {
            showToast(data.error || 'Failed to update quantity', 'error');
            if (data.redirect) {
                window.location.href = data.redirect;
            }
        }
    } catch (error) {
        console.error('Error updating quantity:', error);
        showToast('Failed to update quantity: ' + error.message, 'error');
    }
}

// Remove from Cart
function removeFromCart(productId) {
    console.log(`Removing from cart: ${productId}`);
    fetch('/api/cart', {
        method: 'DELETE',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ product_id: productId }),
        credentials: 'include'
    })
    .then(response => response.json().then(data => ({ status: response.status, body: data })))
    .then(({ status, body }) => {
        if (status >= 400) {
            throw new Error(body.error || 'Failed to remove from cart');
        }
        showToast(body.message || 'Removed from cart', 'success');
        setTimeout(() => {
            console.log('Reloading page after removing from cart');
            location.reload();
        }, 3000);
    })
    .catch(error => {
        console.error('Error removing from cart:', error);
        showToast('Failed to remove from cart: ' + error.message, 'error');
        if (error.message.includes('Unauthorized')) {
            window.location.href = '{{ url_for('user_login') }}';
        }
    });
}

// Cancel Order
function cancelOrder(orderId) {
    console.log(`Initiating cancel order for ID: ${orderId}`);
    if (!confirm('Are you sure you want to cancel this order?')) {
        console.log('Order cancellation aborted by user');
        return;
    }

    fetch(`/api/orders/${orderId}/cancel`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        credentials: 'include'
    })
    .then(response => {
        console.log(`Cancel order response: ${response.status} ${response.statusText}`);
        if (!response.ok) {
            return response.json().then(data => {
                throw new Error(data.error || `HTTP error ${response.status}`);
            });
        }
        return response.json();
    })
    .then(data => {
        console.log('Cancel order response data:', data);
        showToast(data.message || 'Order canceled successfully', 'success');
        setTimeout(() => {
            console.log('Reloading page after canceling order');
            window.location.reload();
        }, 3000);
    })
    .catch(error => {
        console.error('Error canceling order:', error);
        showToast(`Failed to cancel order: ${error.message}`, 'error');
        if (error.message.includes('Unauthorized') || error.message.includes('401')) {
            console.log('Unauthorized, redirecting to login');
            window.location.href = '{{ url_for('user_login') }}';
        }
    });
}

// Show Toast Notification
function showToast(message, type = 'success') {
    console.log(`Showing toast: ${message}, type: ${type}`);
    if (typeof Toastify === 'undefined') {
        console.error('Toastify library not loaded');
        alert(message); // Fallback to alert if Toastify is unavailable
        return;
    }
    try {
        Toastify({
            text: message,
            duration: 4000,
            close: true,
            gravity: "top",
            position: "right",
            backgroundColor: type === 'error' ? '#f87171' : '#22c55e', // Red for error, green for success
            stopOnFocus: true,
            style: {
                zIndex: '3000' // Ensure above modals (z-2000) and navbar (z-1000)
            }
        }).showToast();
        console.log(`Toast displayed: ${message}`);
    } catch (error) {
        console.error('Error displaying Toastify toast:', error);
        alert(message); // Fallback to alert on error
    }
}

async function populateOrders() {
    console.log('Populating orders');
    try {
        const response = await fetch('/api/orders', {
            method: 'GET',
            headers: { 'Content-Type': 'application/json' },
            credentials: 'include'
        });
        const data = await response.json();
        if (!response.ok) {
            throw new Error(data.error || 'Failed to fetch orders');
        }
        const orders = Array.isArray(data) ? data : [];
        console.log('Fetched orders:', orders.map(o => ({ id: o.id, status: o.status, created_at: o.created_at, total: o.total, items: o.items })));
        const orderItems = document.getElementById('order-items');
        if (orderItems) {
            orderItems.innerHTML = orders.length === 0
                ? '<div class="custom-card p-6"><p class="text-gray-600 text-lg">You have no orders.</p></div>'
                : `
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Date</th>
                                <th>Total</th>
                                <th>Status</th>
                                <th>Items</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${orders.map(order => {
                                const totalConverted = (order.total * exchangeRates[currentCurrency]).toFixed(2);
                                const statusLower = order.status ? order.status.toLowerCase().trim() : '';
                                console.log(`Order ${order.id} created_at: ${order.created_at}, formatted: ${formatDate(order.created_at)}`);
                                return `
                                    <tr class="order-card">
                                        <td>#${order.id || 'N/A'}</td>
                                        <td>${formatDate(order.created_at)}</td>
                                        <td>
                                            <span class="price" data-price="${order.total || 0}">${currentCurrency} ${totalConverted}</span>
                                        </td>
                                        <td>${order.status || 'Unknown'}</td>
                                        <td>
                                            ${order.items && Array.isArray(order.items) ? order.items.map(item => `
                                                <div class="flex items-center gap-2 mb-2">
                                                    ${item.image ? `
                                                        <img loading="lazy" src="/static/uploads/${item.image}" alt="${item.product_name || 'Product'}" class="w-10 h-10 object-contain rounded">
                                                    ` : `
                                                        <img loading="lazy" src="https://via.placeholder.com/40x40" alt="No image" class="w-10 h-10 object-contain rounded">
                                                    `}
                                                    <div>
                                                        <p class="text-sm font-medium text-gray-800">${item.product_name || 'Unknown'}</p>
                                                        <p class="text-xs text-gray-600">Qty: ${item.quantity || 1}</p>
                                                    </div>
                                                </div>
                                            `).join('') : '<p class="text-gray-600">No items</p>'}
                                        </td>
                                        <td>
                                            ${statusLower === 'pending' ? `
                                                <button class="action-btn bg-red-600 text-white px-4 py-1 rounded-lg hover:bg-red-700" onclick="cancelOrder(${order.id || 0})">Cancel</button>
                                            ` : `
                                                <span>No action available</span>
                                            `}
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                `;
            updatePrices();
        } else {
            console.error('Order items container (#order-items) not found');
            showToast('Failed to load orders: Container not found', 'error');
        }
    } catch (error) {
        console.error('Error fetching orders:', error);
        const orderItems = document.getElementById('order-items');
        if (orderItems) {
            orderItems.innerHTML = '<div class="custom-card p-6"><p class="text-gray-600 text-lg">Failed to load orders. Please try again later.</p></div>';
        }
        if (error.message.includes('Unauthorized')) {
            showToast('Session expired, please log in', 'error');
            window.location.href = '{{ url_for('user_login') }}';
        } else {
            showToast('Failed to load orders: ' + error.message, 'error');
        }
    }
}

// Toggle Message Code Field
function toggleMessageCode() {
    console.log('Toggling message code visibility');
    const paymentMethod = document.querySelector('input[name="payment_method"]:checked');
    if (paymentMethod) {
        const messageCodeSection = document.getElementById('message-code-section');
        if (messageCodeSection) {
            messageCodeSection.style.display = paymentMethod.value === 'immediate' ? 'block' : 'none';
            if (paymentMethod.value !== 'immediate') {
                const messageCodeInput = document.querySelector('input[name="message_code"]');
                if (messageCodeInput) {
                    messageCodeInput.value = '';
                }
            }
        }
    }
}

// Update Payment Details
function updatePaymentDetails() {
    console.log('Updating payment details');
    const paymentMethod = document.querySelector('input[name="payment_method"]:checked');
    const immediateDetails = document.getElementById('immediate-payment-details');
    const deliveryDetails = document.getElementById('delivery-payment-details');

    if (immediateDetails && deliveryDetails) {
        // Since only Pay on Delivery is available, force show delivery details
        immediateDetails.classList.add('hidden');
        deliveryDetails.classList.remove('hidden');
    } else {
        console.error('Payment details elements not found');
        showToast('Payment details not found', 'error');
    }
}

// Place Order
function placeOrder(event) {
    event.preventDefault();
    console.log('Placing order');
    const form = event.target;
    const paymentMethod = document.querySelector('input[name="payment_method"]:checked');
    const data = {
        name: form.name.value,
        phone_number: form.phone_number.value,
        address: {
            street: form.street.value,
            city: form.city.value,
            country: form.country.value,
            postal_code: form.postal_code.value,
        },
        payment_method: paymentMethod ? paymentMethod.value : null,
        message_code: paymentMethod && paymentMethod.value === 'immediate' ? form.message_code.value : null
    };
    fetch('/api/orders', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
        credentials: 'include'
    })
    .then(response => response.json().then(data => ({ status: response.status, body: data })))
    .then(({ status, body }) => {
        if (status >= 400) {
            throw new Error(body.error || 'Failed to place order');
        }
        showToast(body.message || 'Order placed successfully', 'success');
        closeModal('checkout-modal');
        setTimeout(() => {
            console.log('Reloading page after placing order');
            location.reload();
        }, 3000);
    })
    .catch(error => {
        console.error('Error placing order:', error);
        showToast('Failed to place order: ' + error.message, 'error');
        if (error.message.includes('Unauthorized')) {
            window.location.href = '{{ url_for('user_login') }}';
        }
    });
}

// Mobile Navbar Toggle
document.getElementById('nav-toggler')?.addEventListener('click', () => {
    console.log('Toggling mobile navbar');
    const sidebar = document.getElementById('mobile-sidebar');
    const icon = document.querySelector('#nav-toggler i');
    if (sidebar && icon) {
        sidebar.classList.toggle('-translate-x-full');
        icon.classList.toggle('fa-bars');
        icon.classList.toggle('fa-times');
        icon.classList.add('animate-rotateToggle');
        setTimeout(() => icon.classList.remove('animate-rotateToggle'), 300);
    }
});

// Close Mobile Sidebar
document.getElementById('close-sidebar')?.addEventListener('click', () => {
    console.log('Closing mobile sidebar');
    const sidebar = document.getElementById('mobile-sidebar');
    const icon = document.querySelector('#nav-toggler i');
    if (sidebar && icon) {
        sidebar.classList.add('-translate-x-full');
        icon.classList.add('fa-bars');
        icon.classList.remove('fa-times');
        icon.classList.add('animate-rotateToggle');
        setTimeout(() => icon.classList.remove('animate-rotateToggle'), 300);
    }
});

// Mobile Search Toggle
document.getElementById('mobile-search-icon')?.addEventListener('click', () => {
    console.log('Toggling mobile search');
    const searchBar = document.getElementById('mobile-search-bar');
    const icon = document.getElementById('mobile-search-icon');
    if (searchBar && icon) {
        searchBar.classList.toggle('active');
        icon.classList.add('animate-bounce');
        setTimeout(() => icon.classList.remove('animate-bounce'), 200);
    }
});

// Close Modals on Outside Click
document.querySelectorAll('.modal').forEach(modal => {
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            console.log(`Closing modal ${modal.id} on outside click`);
            closeModal(modal.id);
        }
    });
});

// Toggle Password Visibility
function togglePassword(inputId) {
    console.log(`Toggling password visibility for ${inputId}`);
    const input = document.getElementById(inputId);
    const icon = input?.nextElementSibling;
    if (!input || !icon) {
        console.error(`Input or icon not found for ${inputId}`);
        return;
    }
    if (input.type === 'password') {
        input.type = 'text';
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
    } else {
        input.type = 'password';
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
    }
    icon.classList.add('animate-pulse');
    setTimeout(() => icon.classList.remove('animate-pulse'), 300);
}

// Change Password
async function changePassword(event) {
    event.preventDefault();
    console.log('Change password function called');
    const form = document.getElementById('password-form');
    if (!form) {
        console.error('Password form not found');
        showToast('Form error, please try again', 'error');
        return;
    }
    const oldPassword = form.querySelector('#old-password')?.value;
    const newPassword = form.querySelector('#new-password')?.value;
    const confirmPassword = form.querySelector('#confirm-password')?.value;

    if (!oldPassword || !newPassword || !confirmPassword) {
        console.log('Validation failed: Missing password fields');
        showToast('All password fields are required', 'error');
        return;
    }
    if (newPassword.length < 8) {
        console.log('Validation failed: New password too short');
        showToast('New password must be at least 8 characters long', 'error');
        return;
    }
    if (newPassword !== confirmPassword) {
        console.log('Validation failed: Passwords do not match');
        showToast('New passwords do not match', 'error');
        return;
    }

    try {
        console.log('Sending request to /api/change_password');
        const response = await fetch('/api/change_password', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                old_password: oldPassword,
                new_password: newPassword,
                confirm_password: confirmPassword
            }),
            credentials: 'include'
        });
        console.log(`Response from /api/change_password: ${response.status}`);
        const data = await response.json();
        console.log('Response data:', data);
        if (!response.ok) {
            throw new Error(data.error || 'Failed to change password');
        }
        showToast(data.message || 'Password changed successfully', 'success');
        console.log('Password changed successfully');
        closeModal('password-modal');
        setTimeout(() => {
            console.log('Reloading page after password change');
            location.reload();
        }, 3000);
    } catch (error) {
        console.error('Error changing password:', error);
        showToast('Failed to change password: ' + error.message, 'error');
        if (error.message.includes('Unauthorized')) {
            window.location.href = '{{ url_for('user_login') }}';
        }
    }
}

// Run on page load
document.addEventListener('DOMContentLoaded', () => {
    console.log('Page loaded, initializing account page');
    try {
        const passwordButton = document.getElementById('change-password-btn');
        if (passwordButton) {
            console.log('Change Password button found, adding click listener');
            passwordButton.addEventListener('click', (e) => {
                e.preventDefault();
                console.log('Change Password button clicked, opening password-modal');
                openModal('password-modal');
            });
        } else {
            console.error('Change Password button (#change-password-btn) not found');
            showToast('Change Password button not found', 'error');
        }

        function initializePasswordForm() {
            const passwordForm = document.getElementById('password-form');
            const submitButton = document.getElementById('change-password-submit');
            if (passwordForm) {
                console.log('Password form found, adding submit listener');
                passwordForm.addEventListener('submit', (e) => {
                    console.log('Password form submit event triggered');
                    changePassword(e);
                });
            } else {
                console.error('Password form (#password-form) not found');
                showToast('Password form not found', 'error');
            }
            if (submitButton) {
                console.log('Change Password submit button found, adding click listener');
                submitButton.addEventListener('click', (e) => {
                    e.preventDefault();
                    console.log('Change Password submit button clicked');
                    if (passwordForm) {
                        changePassword({ preventDefault: () => {}, target: passwordForm });
                    } else {
                        console.error('Password form not found during submit');
                        showToast('Form error, please try again', 'error');
                    }
                });
            } else {
                console.error('Change Password submit button (#change-password-submit) not found');
                showToast('Submit button not found', 'error');
            }
        }

        initializePasswordForm();

        const passwordModal = document.getElementById('password-modal');
        if (passwordModal) {
            const observer = new MutationObserver(() => {
                if (passwordModal.classList.contains('open')) {
                    console.log('Password modal opened, re-initializing form listeners');
                    initializePasswordForm();
                }
            });
            observer.observe(passwordModal, { attributes: true, attributeFilter: ['class'] });
        }

        updatePrices();
        toggleMessageCode();
        populateOrders();
    } catch (error) {
        console.error('Error during page initialization:', error);
        showToast('Page initialization failed: ' + error.message, 'error');
    }
});
</script>
</body>
</html>